#+TITLE: COMPLETION
#+AUTHOR: Joey Wu
#+DESCRIPTION: vertico, corfu, marginalia, etc.
#+STARTUP: showeverything
#+OPTIONS: toc:2

This is a minibuffer interface, so it basically replaces the minibuffer UI (M-x). I started out by copying the example config on the github repo.
#+begin_src emacs-lisp
      ;; Enable Vertico.
    (use-package vertico
      :ensure t
      :custom
      ;; (vertico-scroll-margin 0) ;; Different scroll margin
      ;; (vertico-count 20) ;; Show more candidates
      (vertico-resize t) ;; Grow and shrink the Vertico minibuffer
      ;; (vertico-cycle t) ;; Enable cycling for `vertico-next/previous'
      :init
      (vertico-mode)
      )

    ;; Persist history over Emacs restarts. Vertico sorts by history position.
    (use-package savehist
      :ensure t
      :init
      (savehist-mode))

          ;; Optionally use the `orderless' completion style.
  (use-package orderless
    :ensure t
    :custom
    ;; Configure a custom style dispatcher (see the Consult wiki)
    ;; (orderless-style-dispatchers '(+orderless-consult-dispatch orderless-affix-dispatch))
    ;; (orderless-component-separator #'orderless-escapable-split-on-space)
    (completion-styles '(orderless basic))
    (completion-category-overrides '((file (styles partial-completion))))
    (completion-category-defaults nil) ;; Disable defaults, use our settings
    (completion-pcm-leading-wildcard t)) ;; Emacs 31: partial-completion behaves like substring
#+end_src

Again, I copied this from the github.
#+begin_src emacs-lisp
  ;; Enable rich annotations using the Marginalia package
  (use-package marginalia
    :ensure t
    ;; Bind `marginalia-cycle' locally in the minibuffer.  To make the binding
    ;; available in the *Completions* buffer, add it to the
    ;; `completion-list-mode-map'.
    :bind (:map minibuffer-local-map
           ("M-A" . marginalia-cycle))

    ;; The :init section is always executed.
    :init
    ;; the mode gets enabled right away. Note that this forces loading the
    ;; package.
    (marginalia-mode))
#+end_src

Ok, now let's set up corfu.
#+begin_src emacs-lisp
  (use-package corfu
    :ensure t
    :init
    (global-corfu-mode)
    (corfu-popupinfo-mode)
    :config
    (bind-key [remap corfu-info-documentation] #'corfu-doc-toggle
   corfu-map))
#+end_src

add some extensions to corfu with cape
#+begin_src emacs-lisp
  ;; Add extensions
  (use-package cape
    :ensure t
    ;; Bind prefix keymap providing all Cape commands under a mnemonic key.
    ;; Press C-c p ? to for help.
    :bind ("C-c p" . cape-prefix-map) ;; Alternative key: M-<tab>, M-p, M-+
    ;; Alternatively bind Cape commands individually.
    ;; :bind (("C-c p d" . cape-dabbrev)
    ;;        ("C-c p h" . cape-history)
    ;;        ("C-c p f" . cape-file)
    ;;        ...)
    :init
    ;; Add to the global default value of `completion-at-point-functions' which is
    ;; used by `completion-at-point'.  The order of the functions matters, the
    ;; first function returning a result wins.  Note that the list of buffer-local
    ;; completion functions takes precedence over the global list.
    (add-hook 'completion-at-point-functions #'cape-file)
    (add-hook 'completion-at-point-functions #'cape-dabbrev)
    (add-hook 'completion-at-point-functions #'cape-keyword)
    (add-hook 'completion-at-point-functions #'cape-dict)
    (add-hook 'completion-at-point-functions #'cape-elisp-block)
    ;; (add-hook 'completion-at-point-functions #'cape-history)
    ;; ...
  )
#+end_src

this is the collected emacs config from the githubs
#+begin_src emacs-lisp
    ;; Emacs minibuffer configurations.
          (use-package emacs
            :custom
            ;; Enable context menu. `vertico-multiform-mode' adds a menu in the minibuffer
            ;; to switch display modes.
            (context-menu-mode t)
            ;; Support opening new minibuffers from inside existing minibuffers.
            (enable-recursive-minibuffers t)
            ;; Hide commands in M-x which do not work in the current mode.  Vertico
            ;; commands are hidden in normal buffers. This setting is useful beyond
            ;; Vertico.
            (read-extended-command-predicate #'command-completion-default-include-p)
            ;; Do not allow the cursor in the minibuffer prompt
            (minibuffer-prompt-properties
             '(read-only t cursor-intangible t face minibuffer-prompt))
  ;; TAB cycle if there are only few candidates
    ;; (completion-cycle-threshold 3)

    ;; Enable indentation+completion using the TAB key.
    ;; `completion-at-point' is often bound to M-TAB.
    (tab-always-indent 'complete)

    ;; Emacs 30 and newer: Disable Ispell completion function.
    ;; Try `cape-dict' as an alternative.
    (text-mode-ispell-word-completion nil)

    ;; Hide commands in M-x which do not apply to the current mode.  Corfu
    ;; commands are hidden, since they are not used via M-x. This setting is
    ;; useful beyond Corfu.
    (read-extended-command-predicate #'command-completion-default-include-p)
    	)
#+end_src

set up icons for completion
#+begin_src emacs-lisp
  (use-package kind-icon
  :ensure t
  :after corfu
  :custom
  (kind-icon-use-icons t)
  :config
  (add-to-list 'corfu-margin-formatters #'kind-icon-margin-formatter))
#+end_src
